<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .debug-info {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        #chart-container {
            width: 100%;
            height: 400px;
            background: #333;
            margin: 20px 0;
            border: 1px solid #555;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #005a8b;
        }
    </style>
</head>
<body>
    <h1>ğŸ” TradingView Debug Test</h1>
    
    <div class="debug-info">
        <h3>ğŸ“Š Library Status</h3>
        <div id="library-status">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ§ª Test Controls</h3>
        <button class="test-button" onclick="testBTCUSDT()">æµ‹è¯• BINANCE:BTCUSDT</button>
        <button class="test-button" onclick="testETHUSDT()">æµ‹è¯• BINANCE:ETHUSDT</button>
        <button class="test-button" onclick="testDOGEUSDT()">æµ‹è¯• BINANCE:DOGEUSDT</button>
        <button class="test-button" onclick="testInvalidSymbol()">æµ‹è¯•æ— æ•ˆSymbol</button>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ“ Console Output</h3>
        <div id="console-output" style="background: #000; padding: 10px; font-family: monospace; max-height: 200px; overflow-y: auto;"></div>
    </div>
    
    <div id="chart-container"></div>
    
    <!-- TradingView Library -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsoleOutput(type, ...args) {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const color = {
                'log': '#00ff00',
                'error': '#ff0000',
                'warn': '#ffaa00'
            }[type] || '#ffffff';
            
            output.innerHTML += `<div style="color: ${color}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsoleOutput('log', ...args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsoleOutput('error', ...args);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsoleOutput('warn', ...args);
        };
        
        let currentWidget = null;
        
        function checkLibraryStatus() {
            const statusDiv = document.getElementById('library-status');
            
            console.log('ğŸ” æ£€æŸ¥TradingViewåº“çŠ¶æ€...');
            
            if (typeof TradingView === 'undefined') {
                statusDiv.innerHTML = 'âŒ TradingViewåº“æœªåŠ è½½';
                console.error('âŒ TradingViewåº“æœªå®šä¹‰');
                return false;
            }
            
            if (typeof TradingView.widget === 'undefined') {
                statusDiv.innerHTML = 'âŒ TradingView.widgetæœªå®šä¹‰';
                console.error('âŒ TradingView.widgetæœªå®šä¹‰');
                return false;
            }
            
            statusDiv.innerHTML = 'âœ… TradingViewåº“å·²æ­£ç¡®åŠ è½½';
            console.log('âœ… TradingViewåº“çŠ¶æ€æ­£å¸¸');
            return true;
        }
        
        function createChart(symbol) {
            console.log(`ğŸš€ å°è¯•åˆ›å»ºå›¾è¡¨: ${symbol}`);
            
            if (!checkLibraryStatus()) {
                console.error('âŒ æ— æ³•åˆ›å»ºå›¾è¡¨ï¼šåº“æœªæ­£ç¡®åŠ è½½');
                return;
            }
            
            // æ¸…é™¤ç°æœ‰å›¾è¡¨
            if (currentWidget) {
                try {
                    currentWidget.remove();
                    console.log('ğŸ§¹ å·²æ¸…é™¤ç°æœ‰å›¾è¡¨');
                } catch (e) {
                    console.warn('âš ï¸ æ¸…é™¤å›¾è¡¨æ—¶å‡ºé”™:', e);
                }
            }
            
            // æ¸…ç©ºå®¹å™¨
            const container = document.getElementById('chart-container');
            container.innerHTML = '';
            
            try {
                console.log(`ğŸ“Š åˆ›å»ºTradingView widget: ${symbol}`);
                
                currentWidget = new TradingView.widget({
                    width: '100%',
                    height: 400,
                    symbol: symbol,
                    interval: '5',
                    timezone: 'Asia/Shanghai',
                    theme: 'dark',
                    style: '1',
                    locale: 'zh_CN',
                    toolbar_bg: '#1e1e1e',
                    enable_publishing: false,
                    hide_top_toolbar: true,
                    hide_legend: true,
                    save_image: false,
                    container_id: 'chart-container',
                    onChartReady: function() {
                        console.log(`ğŸ‰ å›¾è¡¨åˆ›å»ºæˆåŠŸ: ${symbol}`);
                    },
                    onError: function(error) {
                        console.error(`ğŸ’¥ å›¾è¡¨åˆ›å»ºå¤±è´¥: ${symbol}`, error);
                    }
                });
                
                console.log(`âœ… Widgetåˆ›å»ºå®Œæˆ: ${symbol}`);
                
            } catch (error) {
                console.error(`ğŸ’¥ åˆ›å»ºå›¾è¡¨æ—¶å‘ç”Ÿå¼‚å¸¸: ${symbol}`, error);
                console.error(`ğŸ’¥ é”™è¯¯è¯¦æƒ…:`, error.stack);
            }
        }
        
        function testBTCUSDT() {
            createChart('BINANCE:BTCUSDT');
        }
        
        function testETHUSDT() {
            createChart('BINANCE:ETHUSDT');
        }
        
        function testDOGEUSDT() {
            createChart('BINANCE:DOGEUSDT');
        }
        
        function testInvalidSymbol() {
            createChart('BINANCE:INVALIDCOIN');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', function() {
            console.log('ğŸŒ é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç­‰å¾…TradingViewåº“åŠ è½½
            setTimeout(function() {
                checkLibraryStatus();
                
                // è‡ªåŠ¨æµ‹è¯•BTCUSDT
                console.log('ğŸ”„ è‡ªåŠ¨æµ‹è¯•BTCUSDT...');
                testBTCUSDT();
            }, 2000);
        });
    </script>
</body>
</html>