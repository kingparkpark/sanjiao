<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingView ç®€å•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 10px 0;
            border: 1px solid #444;
        }
        .log {
            background: #2a2a2a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>TradingView ç®€å•æµ‹è¯•</h1>
    
    <div class="test-container">
        <h2>æµ‹è¯• 1: æ£€æŸ¥ TradingView åº“</h2>
        <div id="library-status"></div>
    </div>
    
    <div class="test-container">
        <h2>æµ‹è¯• 2: åˆ›å»º BTCUSDT å›¾è¡¨</h2>
        <div id="chart1" class="chart-container"></div>
        <div id="chart1-log" class="log"></div>
    </div>
    
    <div class="test-container">
        <h2>æµ‹è¯• 3: åˆ›å»º BINANCE:BTCUSDT å›¾è¡¨</h2>
        <div id="chart2" class="chart-container"></div>
        <div id="chart2-log" class="log"></div>
    </div>
    
    <div class="test-container">
        <h2>æµ‹è¯• 4: åˆ›å»ºæ— æ•ˆ symbol å›¾è¡¨</h2>
        <div id="chart3" class="chart-container"></div>
        <div id="chart3-log" class="log"></div>
    </div>
    
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function checkLibrary() {
            const statusDiv = document.getElementById('library-status');
            
            if (typeof TradingView === 'undefined') {
                statusDiv.innerHTML = '<span class="error">âŒ TradingView åº“æœªåŠ è½½</span>';
                log('chart1-log', 'TradingView åº“æœªåŠ è½½', 'error');
                return false;
            }
            
            if (typeof TradingView.widget === 'undefined') {
                statusDiv.innerHTML = '<span class="error">âŒ TradingView.widget æœªå®šä¹‰</span>';
                log('chart1-log', 'TradingView.widget æœªå®šä¹‰', 'error');
                return false;
            }
            
            statusDiv.innerHTML = '<span class="success">âœ… TradingView åº“åŠ è½½æˆåŠŸ</span>';
            log('chart1-log', 'TradingView åº“åŠ è½½æˆåŠŸ', 'success');
            return true;
        }
        
        function createChart(containerId, symbol, logId) {
            log(logId, `å¼€å§‹åˆ›å»ºå›¾è¡¨: ${symbol}`, 'info');
            
            try {
                const widget = new TradingView.widget({
                    width: '100%',
                    height: 400,
                    symbol: symbol,
                    interval: '5',
                    timezone: 'Asia/Shanghai',
                    theme: 'dark',
                    style: '1',
                    locale: 'zh_CN',
                    toolbar_bg: '#1e1e1e',
                    enable_publishing: false,
                    hide_top_toolbar: true,
                    hide_legend: true,
                    save_image: false,
                    container_id: containerId,
                    overrides: {
                        'paneProperties.background': '#1a1a1a',
                        'paneProperties.vertGridProperties.color': '#2a2a2a',
                        'paneProperties.horzGridProperties.color': '#2a2a2a'
                    },
                    disabled_features: [
                        'use_localstorage_for_settings',
                        'volume_force_overlay',
                        'create_volume_indicator_by_default',
                        'header_compare',
                        'header_undo_redo',
                        'header_screenshot',
                        'header_chart_type',
                        'header_settings',
                        'header_indicators',
                        'header_symbol_search',
                        'symbol_search_hot_key',
                        'header_resolutions',
                        'timeframes_toolbar'
                    ],
                    onChartReady: () => {
                        log(logId, `âœ… å›¾è¡¨åˆ›å»ºæˆåŠŸ: ${symbol}`, 'success');
                        
                        widget.onChartReady(() => {
                            widget.chart().onSymbolChanged().subscribe(null, (symbolInfo) => {
                                if (symbolInfo && symbolInfo.error) {
                                    log(logId, `âŒ Symbol é”™è¯¯: ${symbolInfo.error}`, 'error');
                                } else {
                                    log(logId, `ğŸ“Š Symbol å˜æ›´æˆåŠŸ: ${JSON.stringify(symbolInfo)}`, 'success');
                                }
                            });
                        });
                    },
                    onError: (error) => {
                        log(logId, `âŒ å›¾è¡¨é”™è¯¯: ${JSON.stringify(error)}`, 'error');
                    }
                });
                
                log(logId, `å›¾è¡¨ widget åˆ›å»ºå®Œæˆ`, 'info');
                
            } catch (error) {
                log(logId, `âŒ åˆ›å»ºå›¾è¡¨å¼‚å¸¸: ${error.message}`, 'error');
                log(logId, `é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }
        
        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('chart1-log', 'å¼€å§‹æµ‹è¯•...', 'info');
                
                // æ£€æŸ¥åº“
                if (!checkLibrary()) {
                    return;
                }
                
                // æµ‹è¯•ä¸åŒçš„ symbol æ ¼å¼
                setTimeout(() => createChart('chart1', 'BTCUSDT', 'chart1-log'), 1000);
                setTimeout(() => createChart('chart2', 'BINANCE:BTCUSDT', 'chart2-log'), 2000);
                setTimeout(() => createChart('chart3', 'INVALID:SYMBOL', 'chart3-log'), 3000);
                
            }, 1000);
        });
    </script>
</body>
</html>